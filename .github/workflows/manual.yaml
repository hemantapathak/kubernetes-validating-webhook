name: Manual Workflow Trigger

on:
  workflow_dispatch:
    inputs:
      parameter_name:
        description: 'Optional description'
        required: false

jobs:
  file_hash:
    runs-on: self-hosted
    env:
      LOCAL_PATH: checkout
    steps:
      - name: Build the code
        uses: actions/checkout@v4
        with:
          repository: ''
          path: $(LOCAL_PATH)
          token: ${{ secrets.BUILD_VERIFIER }}
          ref: master
      - name: Post build calculate hash of all the files
        uses: actions/checkout@v4
        with:
          repository: Encryption-Consulting-LLC/Build-Verification
          path: ''
          token: ${{ secrets.BUILD_VERIFIER }}
          ref: main
          clean: false
      - name: Calculate the hash of all the files
        id: get-hash
        run: |
          $output=($GITHUB_WORKSPACE/build-verifier-on-build-trigger.py $GITHUB_WORKSPACE/$LOCAL_PATH)
          Write-Output "::set-output name=FILE_HASHES::$output"
      - name: Verify the hashes
        # Usage: verify.py repo_name branch_name file_hash_input
        run: $GITHUB_WORKSPACE/verify_hash.py $GITHUB_REPOSITORY $GITHUB_REF_NAME  ${{ steps.get-hash.outputs.FILE_HASHES }}
